>create by jzf@2018/12/15
# vsftpd的安装和使用

## 经过
    从13号晚上开始，我打算安装一个ftp服务器，为了以后的守教图书馆做准备。
    一开始主要考虑这么几点
    1，了解linux的用户创建和权限分配
    2，选择一个给力的ftp服务器
    3，计划先在虚拟机上测试，然后上云服务器
计划执行1
    1，了解了adduser这个命令和usermod，测试的还不错吧
    2，随手百度就是推荐 vsftpd服务器
    3，果然花钱买了高性能的台式机用起来就是好，没有被 “不能在云上直接搞”这种想法，阻碍了我的计划执行
计划执行2
    我在虚拟机上安装，并且按照网页的介绍进行了配置，结果使用网页并不能够访问ftp。
    开始分析哪里做的不对
    1，我并没有完完全全的按照网页上的介绍来的，什么虚拟用户啊之类的，匿名啊，我都是按照自己的理解进行了选择性的操作。
        这里边最坑的一点就是，我他么没有按照人家说的备份一下conf

        重新来一遍是不可能了，我进行只好逐个的进行修改和测试。
进入问题分析模式
    开始思考哪里可能有问题。
    1，listen=YES和NO会不会影响
    2，看到有介绍user_list的，我配置了一下
    3，看到有chroot控制的，我配置了一下
    4，配置local_root=/home/showftp
    5，权限问题，有一次我寻思着允许读写不允许执行程序，似乎连cd都用不了了。
    
    改动的过程是复杂的，出现过root用户能登陆，但是后来配置的用户不行之类的问题
    
    参数修改的太多了，我怎么也整不明白了
进入reset模式
    apt-get  remove --purge vsftpd
    apt-get  autoremove --purge vsftpd //似乎只用这个就好
    
    这个我秉持着这么一个观念，一个软件讲道理应该下载下来就能基本使用，而不需要去进行乱七八糟的配置。
    1，凡是不在conf原来就有的我就不要去加了
    2，直接建立一个真正的用户showftp，也不搞什么禁止shell登陆之类的。排除只有root能登陆，是我瞎搞权限的问题
    然后还是时灵时不灵

    就这么到了14号的下午，老北河安装了，而且几乎十分钟之内配置的差不多了
    发给我一个网址，我瞅了一眼东西我都见过。
    
    期间由于下午在工作，我直接上云搞事。
    还是出现连上报错，网页转圈之类的毛病

    1，我开放了40000-50000的端口，我试着加了pasv的配置
    2，老北河cmd模式下telnet测试我的ftp是否启动，想起来cmd还可以使用ftp程序
    
    又是一顿配置，把文件搞乱了，等晚上跟老北河要个配置文件
进入幸运模式
    晚上回家拿到了老北河的conf文件，我一看狗日的基本没有啥个配置么。
    还原，开始测试。时间也比较长了，脑子里对一些配置记得清楚了，也有信心了。

    三种登陆模式
        网页
        资源管理器
        cmd ftp
    下午在使用cmd的ftp测试的时候，一直是连接成功，但是之后的ls命令就完蛋了。
    网页和资源管理器仍不给力，转圈，有时候还能登陆，我就搜了一下为啥慢，介绍说什么listen配置一下啊
    清一下dns啊不好使


    回到寝室，我排除了公司那垃圾配置和网速的事，ftp操作完全没有问题
    搜索信息，发现是主动还是被动模式的锅、

    浏览器和资源管理器应该都是被动模式，在internet选项 高级里边去掉，就网页和资源管理器就可以了
    当然，还是他喵的不给力，创建文件啊之类的操作并不给力。

    >https://bbs.csdn.net/topics/392080374?list=lz

问题解决

    最后我选择了被动模式，解决了所有的问题
## 中间试错的一些收获
* 使用用户列表控制可登陆的用户
    userlist_enable=YES
    userlist_deny=NO
    userlist_file=/etc/user_list

* 修改登陆的根节点
local_root=/home/ftp/ 似乎和chroot那边结合可以达到用户列表的效果

* 禁止用户shell登陆
1、usermod -s /bin/false username 用户会无法登录,并且不会有任何提示 
2、usermod -s /usr/sbin/nologin username 用户会无法登录,但是给出提示语
这边似乎有时候会影响ftp的登陆=，=有时间了解下

* vsftpd似乎会默认生成一个匿名用户，匿名还会有一个路径
/var/pub ？？
有时间了解一下啊
* 禁止shell登陆
如果 usermod -s /bin/false showftp 之后不能登陆ftp了
可以在/etc/shells加 /bin/false
测试
ssh xxx@xxx  确实无法登陆
ftp可以登录


* 其他
暂时记不起来了

## 总结
经验上的一些东西，就是在尝试一些新事物的时候

1，缺乏一定基础，百度啊之类的会对自身造成误导，使逻辑和判断树出错
2，尝试要果断，也要减少怀疑的参数，不能盲目的乱搞
3，要能备份能还原





## 一些参考
>https://www.linuxidc.com/Linux/2017-06/144807.htm
>http://blog.51cto.com/meiling/2071122